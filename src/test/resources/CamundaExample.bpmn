<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:modeler="http://camunda.org/schema/modeler/1.0" id="Definitions_1vwt4ni" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="5.6.0" modeler:executionPlatform="Camunda Platform" modeler:executionPlatformVersion="7.17.0">
  <bpmn:process id="CamundaExample" name="Camunda Example" isExecutable="true" camunda:versionTag="01">
    <bpmn:startEvent id="request_event">
      <bpmn:outgoing>Flow_1b3lrsr</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:serviceTask id="audit" name="Audit" camunda:asyncBefore="true" camunda:delegateExpression="#{auditDelegate}">
      <bpmn:incoming>Flow_0lhveyc</bpmn:incoming>
      <bpmn:outgoing>Flow_0avl7g1</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_0avl7g1" sourceRef="audit" targetRef="end_event" />
    <bpmn:subProcess id="Activity_0n9eyey">
      <bpmn:incoming>Flow_1b3lrsr</bpmn:incoming>
      <bpmn:outgoing>Flow_0lhveyc</bpmn:outgoing>
      <bpmn:startEvent id="start_event">
        <bpmn:outgoing>Flow_0pcl863</bpmn:outgoing>
      </bpmn:startEvent>
      <bpmn:serviceTask id="call_a" name="Call A" camunda:asyncBefore="true" camunda:delegateExpression="#{callADelegate}">
        <bpmn:incoming>Flow_0pcl863</bpmn:incoming>
        <bpmn:outgoing>Flow_1af71hs</bpmn:outgoing>
      </bpmn:serviceTask>
      <bpmn:serviceTask id="call_b" name="Call B" camunda:asyncBefore="true" camunda:delegateExpression="#{callBDelegate}">
        <bpmn:incoming>Flow_1af71hs</bpmn:incoming>
        <bpmn:outgoing>Flow_06dswzi</bpmn:outgoing>
      </bpmn:serviceTask>
      <bpmn:serviceTask id="compensate_a" name="Compensate A" isForCompensation="true" camunda:delegateExpression="#{compensateADelegate}" />
      <bpmn:serviceTask id="compensate_b" name="Compensate B" isForCompensation="true" camunda:delegateExpression="#{compensateBDelegate}" />
      <bpmn:exclusiveGateway id="Gateway_105xwbc" name="Throw an error?">
        <bpmn:incoming>Flow_06dswzi</bpmn:incoming>
        <bpmn:outgoing>Flow_0mzi2gy</bpmn:outgoing>
        <bpmn:outgoing>Flow_0zk82i4</bpmn:outgoing>
      </bpmn:exclusiveGateway>
      <bpmn:serviceTask id="throw_error" name="Throw Error" camunda:asyncBefore="true" camunda:delegateExpression="#{throwErrorDelegate}">
        <bpmn:incoming>Flow_0mzi2gy</bpmn:incoming>
      </bpmn:serviceTask>
      <bpmn:boundaryEvent id="Event_02xi613" attachedToRef="call_b">
        <bpmn:compensateEventDefinition id="CompensateEventDefinition_0izgxkr" />
      </bpmn:boundaryEvent>
      <bpmn:boundaryEvent id="Event_0t3742b" attachedToRef="call_a">
        <bpmn:compensateEventDefinition id="CompensateEventDefinition_03vb116" />
      </bpmn:boundaryEvent>
      <bpmn:sequenceFlow id="Flow_1af71hs" sourceRef="call_a" targetRef="call_b" />
      <bpmn:sequenceFlow id="Flow_06dswzi" sourceRef="call_b" targetRef="Gateway_105xwbc" />
      <bpmn:sequenceFlow id="Flow_0mzi2gy" name="Yes" sourceRef="Gateway_105xwbc" targetRef="throw_error">
        <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${THROW_ERROR == true}</bpmn:conditionExpression>
      </bpmn:sequenceFlow>
      <bpmn:sequenceFlow id="Flow_0pcl863" sourceRef="start_event" targetRef="call_a" />
      <bpmn:endEvent id="Event_1vgl7su">
        <bpmn:incoming>Flow_0zk82i4</bpmn:incoming>
      </bpmn:endEvent>
      <bpmn:sequenceFlow id="Flow_0zk82i4" name="no" sourceRef="Gateway_105xwbc" targetRef="Event_1vgl7su" />
      <bpmn:subProcess id="Activity_1i3mv9z" name="Error handler sub-process" triggeredByEvent="true">
        <bpmn:startEvent id="Event_1xddww3">
          <bpmn:outgoing>Flow_0qxbalv</bpmn:outgoing>
          <bpmn:errorEventDefinition id="ErrorEventDefinition_0jjl6eh" />
        </bpmn:startEvent>
        <bpmn:intermediateThrowEvent id="trigger_compensation" camunda:asyncBefore="true">
          <bpmn:incoming>Flow_15nzh38</bpmn:incoming>
          <bpmn:outgoing>Flow_1ngsuvh</bpmn:outgoing>
          <bpmn:compensateEventDefinition id="CompensateEventDefinition_00btb05" />
        </bpmn:intermediateThrowEvent>
        <bpmn:serviceTask id="handle_error" name="Handle Error" camunda:asyncBefore="true" camunda:delegateExpression="#{handleErrorDelegate}">
          <bpmn:incoming>Flow_0qxbalv</bpmn:incoming>
          <bpmn:outgoing>Flow_15nzh38</bpmn:outgoing>
        </bpmn:serviceTask>
        <bpmn:sequenceFlow id="Flow_15nzh38" sourceRef="handle_error" targetRef="trigger_compensation" />
        <bpmn:sequenceFlow id="Flow_0qxbalv" sourceRef="Event_1xddww3" targetRef="handle_error" />
        <bpmn:endEvent id="error_handled">
          <bpmn:incoming>Flow_1ngsuvh</bpmn:incoming>
        </bpmn:endEvent>
        <bpmn:sequenceFlow id="Flow_1ngsuvh" sourceRef="trigger_compensation" targetRef="error_handled" />
      </bpmn:subProcess>
      <bpmn:association id="Association_16urc96" sourceRef="call_a" targetRef="TextAnnotation_06l7p3v" />
      <bpmn:association id="Association_19zakaz" sourceRef="call_b" targetRef="TextAnnotation_1nduzce" />
      <bpmn:association id="Association_1xgcbet" associationDirection="One" sourceRef="Event_0t3742b" targetRef="compensate_a" />
      <bpmn:association id="Association_1g5ljz8" associationDirection="One" sourceRef="Event_02xi613" targetRef="compensate_b" />
      <bpmn:textAnnotation id="TextAnnotation_06l7p3v">
        <bpmn:text>Call service A</bpmn:text>
      </bpmn:textAnnotation>
      <bpmn:textAnnotation id="TextAnnotation_1nduzce">
        <bpmn:text>Call service B</bpmn:text>
      </bpmn:textAnnotation>
    </bpmn:subProcess>
    <bpmn:sequenceFlow id="Flow_1b3lrsr" sourceRef="request_event" targetRef="Activity_0n9eyey" />
    <bpmn:sequenceFlow id="Flow_0lhveyc" sourceRef="Activity_0n9eyey" targetRef="audit" />
    <bpmn:endEvent id="end_event" name="The End">
      <bpmn:incoming>Flow_0avl7g1</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:textAnnotation id="TextAnnotation_0bk3pu6">
      <bpmn:text>Input:
Â  - THROW_ERROR : true | false</bpmn:text>
    </bpmn:textAnnotation>
    <bpmn:association id="Association_0ip1x95" sourceRef="request_event" targetRef="TextAnnotation_0bk3pu6" />
  </bpmn:process>
  <bpmn:message id="Message_1uhjs64" name="audit_msg" />
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="CamundaExample">
      <bpmndi:BPMNShape id="TextAnnotation_0bk3pu6_di" bpmnElement="TextAnnotation_0bk3pu6">
        <dc:Bounds x="160" y="140" width="189" height="44" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="request_event">
        <dc:Bounds x="279" y="239" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0uo0ynj_di" bpmnElement="audit">
        <dc:Bounds x="1390" y="217" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1858t64_di" bpmnElement="end_event">
        <dc:Bounds x="1662" y="239" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1661" y="282" width="41" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0n9eyey_di" bpmnElement="Activity_0n9eyey" isExpanded="true">
        <dc:Bounds x="410" y="80" width="908" height="630" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_06l7p3v_di" bpmnElement="TextAnnotation_06l7p3v">
        <dc:Bounds x="620" y="143" width="140" height="31" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_1nduzce_di" bpmnElement="TextAnnotation_1nduzce">
        <dc:Bounds x="780" y="143" width="140" height="31" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1700irp_di" bpmnElement="call_a">
        <dc:Bounds x="620" y="220" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_15kkde2_di" bpmnElement="start_event">
        <dc:Bounds x="432" y="242" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_173ycrj_di" bpmnElement="call_b">
        <dc:Bounds x="780" y="220" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0wt5cca_di" bpmnElement="compensate_a">
        <dc:Bounds x="655" y="363" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0j55eay_di" bpmnElement="compensate_b">
        <dc:Bounds x="810" y="363" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_105xwbc_di" bpmnElement="Gateway_105xwbc" isMarkerVisible="true">
        <dc:Bounds x="945" y="235" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="931" y="211" width="78" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_15j4w3u_di" bpmnElement="throw_error">
        <dc:Bounds x="1060" y="363" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1vgl7su_di" bpmnElement="Event_1vgl7su">
        <dc:Bounds x="1162" y="242" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_12y0uzs_di" bpmnElement="Activity_1i3mv9z" isExpanded="true">
        <dc:Bounds x="520" y="490" width="720" height="200" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1p85ubj_di" bpmnElement="Event_1xddww3">
        <dc:Bounds x="560" y="572" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1rjg60p_di" bpmnElement="trigger_compensation">
        <dc:Bounds x="922" y="572" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0orwe8g_di" bpmnElement="handle_error">
        <dc:Bounds x="680" y="550" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1bm3bls_di" bpmnElement="error_handled">
        <dc:Bounds x="1102" y="572" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_0qxbalv_di" bpmnElement="Flow_0qxbalv">
        <di:waypoint x="596" y="590" />
        <di:waypoint x="680" y="590" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_15nzh38_di" bpmnElement="Flow_15nzh38">
        <di:waypoint x="780" y="590" />
        <di:waypoint x="922" y="590" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1ngsuvh_di" bpmnElement="Flow_1ngsuvh">
        <di:waypoint x="958" y="590" />
        <di:waypoint x="1102" y="590" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_16urc96_di" bpmnElement="Association_16urc96">
        <di:waypoint x="670" y="220" />
        <di:waypoint x="670" y="174" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_19zakaz_di" bpmnElement="Association_19zakaz">
        <di:waypoint x="830" y="220" />
        <di:waypoint x="830" y="174" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_1xgcbet_di" bpmnElement="Association_1xgcbet">
        <di:waypoint x="705" y="318" />
        <di:waypoint x="705" y="363" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_1g5ljz8_di" bpmnElement="Association_1g5ljz8">
        <di:waypoint x="860" y="318" />
        <di:waypoint x="860" y="363" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="Event_1tzno8q_di" bpmnElement="Event_0t3742b">
        <dc:Bounds x="687" y="282" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_11u7q27_di" bpmnElement="Event_02xi613">
        <dc:Bounds x="842" y="282" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_0pcl863_di" bpmnElement="Flow_0pcl863">
        <di:waypoint x="468" y="260" />
        <di:waypoint x="620" y="260" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1af71hs_di" bpmnElement="Flow_1af71hs">
        <di:waypoint x="720" y="260" />
        <di:waypoint x="780" y="260" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_06dswzi_di" bpmnElement="Flow_06dswzi">
        <di:waypoint x="880" y="260" />
        <di:waypoint x="945" y="260" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0mzi2gy_di" bpmnElement="Flow_0mzi2gy">
        <di:waypoint x="970" y="285" />
        <di:waypoint x="970" y="403" />
        <di:waypoint x="1060" y="403" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1012" y="381" width="18" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0zk82i4_di" bpmnElement="Flow_0zk82i4">
        <di:waypoint x="995" y="260" />
        <di:waypoint x="1162" y="260" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1072" y="242" width="13" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_0ip1x95_di" bpmnElement="Association_0ip1x95">
        <di:waypoint x="289" y="241" />
        <di:waypoint x="242" y="184" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1b3lrsr_di" bpmnElement="Flow_1b3lrsr">
        <di:waypoint x="315" y="257" />
        <di:waypoint x="410" y="257" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0lhveyc_di" bpmnElement="Flow_0lhveyc">
        <di:waypoint x="1318" y="257" />
        <di:waypoint x="1390" y="257" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0avl7g1_di" bpmnElement="Flow_0avl7g1">
        <di:waypoint x="1490" y="257" />
        <di:waypoint x="1662" y="257" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
